---
title: "The cost, both human and financial, of storm events"
author: "I Carter (Coursera)"
output: 
  html_document:
    keep_md: true
    toc: true
---

## Synopsis

In this project I carried out an analysis of the U.S. National Oceanic and Atmospheric Administration's (NOAA) Storm Database. I recorded my exploratory analysis in `ExploratoryAnalysis.Rmd`.

----

## Data Processing

### Read in dataset

```{r echo = TRUE}
bz <- bzfile("repdata_data_StormData.csv.bz2", "r")
data <- read.csv(bz)
close(bz)
```

----

### Most Harmful `EVTYPE`s

***Across the United States, which types of events (as indicated in the `EVTYPE` variable) are most harmful with respect to population health?***

#### How many fatalities and injuries in total?

```{r echo = TRUE}
total_deaths <- sum(data$FATALITIES)
total_deaths    ## 15145
total_injuries <- sum(data$INJURIES)
total_injuries  ## 140528
```

#### Which are the top ten fatal event types?

```{r echo = TRUE}
fatal <- tapply(data$FATALITIES, data$EVTYPE, sum)
fatal_percentage <- fatal/total_deaths * 100
fatal[which.max(fatal)]         ## which is the most fatal event type?
fatal_indices <- order(fatal, decreasing=TRUE)
fatal[fatal_indices[1:10]]
fatal_percentage[fatal_indices[1:10]]
```

#### Which are the top ten injurious event types?

```{r echo = TRUE}
injurious <- tapply(data$INJURIES, data$EVTYPE, sum)
injurious_percentage <- injurious/total_injuries * 100
injurious[which.max(injurious)]    ## which is the most injurious event type?
injurious_indices <- order(injurious, decreasing=TRUE)
injurious[injurious_indices[1:10]]
injurious_percentage[injurious_indices[1:10]]
```

## The Most Dangerous Event Types

```{r echo = TRUE}
par(mfrow=c(2, 1), cex=0.8)
barplot(fatal[fatal_indices[1:10]], axisnames=FALSE,
    col = hcl.colors(10, palette="Spectral"), legend=TRUE)
title("Top Ten Causes of Fatality")
barplot(injurious[injurious_indices[1:10]], axisnames=FALSE,
    col = hcl.colors(10, palette="Spectral"), legend=TRUE)
title("Top Ten Causes of Injury")
```

----

### Costliness

***Across the United States, which types of events have the greatest economic consequences?***

The relevant columns seem to be `PROPDMG`, `PROPDMGEXP`, `CROPDMG`, and `CROPDMGEXP`.

```{r echo = TRUE}
levels(data$PROPDMGEXP)         ## ""  "-" "?" "+" "0" "1" "2" "3" "4" "5" "6" "7" "8" "B" "h" "H" "K" "m" "M"
levels(data$CROPDMGEXP)
summary(data$CROPDMGEXP)        ## ""  "?" "0" "2" "B" "k" "K" "m" "M"
summary(data$PROPDMGEXP)
```

We'll have a look at some of the records where `PROPDMGEXP` is 4, 5, 6, 7, or 8. If `PROPDMGEXP` is indeed an exponent these events would be pretty costly.

```
prop6 <- data[data$PROPDMGEXP == 4,]    ## 4 records
prop7 <- data[data$PROPDMGEXP == 5,]    ## 28 records
prop6 <- data[data$PROPDMGEXP == 6,]    ## 4 records
prop7 <- data[data$PROPDMGEXP == 7,]    ## 5 records
prop8 <- data[data$PROPDMGEXP == 8,]    ## 1 record
as.character(prop4$REMARKS)
as.character(prop5$REMARKS)
as.character(prop6$REMARKS)
as.character(prop7$REMARKS)
as.character(prop8$REMARKS)
```

We see that

We also see that, while we have removed the empty comments, some of the remarks are `"  "` (2 spaces), which is not helpful.

The numeric values of `PROPDMGEXP` don't seem to have a consistant meaning.

"h" or "H" seems to stand for hundreds; "k" or "K" for thousands; "m" or "M" for millions; and "B" for billions.

#### How many events cause no property damage or no crop damage?

```{r echo = TRUE}
prop0 <- data[data$PROPDMG == 0,]
dim(prop0)[1]/dim(data)[1] * 100        ## 73.5%
crop0 <- data[data$CROPDMG == 0,]
dim(crop0)[1]/dim(data)[1] * 100        ## 97.5%
```

```{r echo = TRUE}
temp <- as.character(prop0$REMARKS)
temp <- temp[temp!=""]
temp[1:12]
```

Well, this means that we can't assume that `PROPDMG == 0` means no property damage. For example one of the `REMARKS` where `PROPDMG == 0` explicitly states "Damage to homes and businesses was widespread." Presumably the data for crop damage is similarly flaky.

But we can only deal with the data we have. We just need to bear in mind that it is not fully accurate or complete.

----

## Results

The questions that need answers are:

### Most Harmful `EVTYPE`s

Across the United States, which types of events (as indicated in the `EVTYPE` variable) are most harmful with respect to population health?

### Economic Consequences

Across the United States, which types of events have the greatest economic consequences?

----

This document was processed on: `r Sys.Date()`.
